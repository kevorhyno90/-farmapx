<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <link rel="stylesheet" type="text/css" href="/styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <%- include('partials/navbar') %>
    <div class="container">
        <h1>Farm Dashboard</h1>
        <p>Welcome to your farm management dashboard. From here, you can access all sections of your farm's operations.</p>

        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h2>Financials Overview</h2>
                <canvas id="financialsChart"></canvas>
            </div>
            <div class="dashboard-card">
                <h2>Crop Distribution</h2>
                <canvas id="cropsChart"></canvas>
            </div>
        </div>
        
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h2>Crops</h2>
                <p>Manage all your crops, from planting to harvest.</p>
                <a href="/crops" class="btn">Go to Crops</a>
            </div>
            <div class="dashboard-card">
                <h2>Livestock</h2>
                <p>Keep track of all your livestock and their health records.</p>
                <a href="/livestock" class="btn">Go to Livestock</a>
            </div>
            <div class="dashboard-card">
                <h2>Inventory</h2>
                <p>Monitor your inventory levels for feed, tools, and other supplies.</p>
                <a href="/inventory" class="btn">Go to Inventory</a>
            </div>
            <div class="dashboard-card">
                <h2>Financials</h2>
                <p>Track your farm's income, expenses, and overall financial health.</p>
                <a href="/financials" class="btn">Go to Financials</a>
            </div>
        </div>
    </div>

    <script>
        const financialsData = <async (params) => {
            %
        }- JSON.stringify(financials) %>;
        const cropsData = <%- JSON.stringify(crops) %>;

        // Financials Chart
        const income = financialsData.filter(item => item.type === 'income').reduce((acc, item) => acc + item.amount, 0);
        const expenses = financialsData.filter(item => item.type === 'expense').reduce((acc, item) => acc + item.amount, 0);

        const financialsCtx = document.getElementById('financialsChart').getContext('2d');
        new Chart(financialsCtx, {
            type: 'bar',
            data: {
                labels: ['Income', 'Expenses'],
                datasets: [{
                    label: 'Total',
                    data: [income, expenses],
                    backgroundColor: [
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(255, 99, 132, 0.2)'
                    ],
                    borderColor: [
                        'rgba(75, 192, 192, 1)',
                        'rgba(255, 99, 132, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Crops Chart
        const cropCounts = cropsData.reduce((acc, crop) => {
            acc[crop.name] = (acc[crop.name] || 0) + 1;
            return acc;
        }, {});

        const cropLabels = Object.keys(cropCounts);
        const cropDataPoints = Object.values(cropCounts);

        const cropsCtx = document.getElementById('cropsChart').getContext('2d');
        new Chart(cropsCtx, {
            type: 'pie',
            data: {
                labels: cropLabels,
                datasets: [{
                    label: 'Crop Distribution',
                    data: cropDataPoints,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.7)',
                        'rgba(54, 162, 235, 0.7)',
                        'rgba(255, 206, 86, 0.7)',
                        'rgba(75, 192, 192, 0.7)',
                        'rgba(153, 102, 255, 0.7)',
                        'rgba(255, 159, 64, 0.7)'
                    ],
                    borderWidth: 1
                }]
            }
        });
    </script>
</body>
</html>